<!DOCTYPE html>

<style>
  #formatter {
    font-family: Arial;
    color: #2F3D45;
    width: 1200px;
  }
  #inputQuery {
    background-color: #f5f5f5;
    border-radius: 0.5vw;
    border-style:solid;
    font-size: 14px;
    color: #2F3D45;
    outline: none;
    padding: 14px;
    border:none;
    width: 100%;
  }
  #outputQuery {
    word-break: break-all;
    text-align: left;
    padding: 14px;
  }
</style>

<script>
  // Function to flatten an array
  const flatten = array => {
    flatArray = [];
    for (let element of array) {
      if (Array.isArray(element)) {
        flatArray.push(flatten(element));
      } else {
        flatArray.push(element);
      }
    }
    return flatArray;
  }

  const format = (query) => {
    // Remove all whitespaes
    query = query.replace(/\s/g, '');
    // Split on punctuation
    query = query.split('.');
    // If there are multiple open parentheses, then newline and indent all of the following lines
    for (let lineIndex of Object.keys(query)) {
      if (query[lineIndex].split('(').length > 2) {
        query[lineIndex] = query[lineIndex].split('(').join('(<br>');
      }
    }



    // Add space before all elements which are not one of the first three
    query = query.map((element, index) => element = index < 3 ? element : '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + element);
    // Add newline before all elements which are not one of the first three
    query = query.map((element, index) => element = index < 3 ? element : '<br>' + element);

    query = query.join('.');
    return '<code>' + query + '</code>';
  }
</script>

<body>
  <center>
    <div id='formatter' >
      <form>
        <textarea id='inputQuery'
                  name='input'
                  cols=100
                  rows=10
                  oninput="document.getElementById('outputQuery').innerHTML=format(value);"></textarea>
      </form>
      <div id='outputQuery'></div>
    </div>
  </center>
</body>